---
title: "Visualization of Model Predicting Cumulative Utterances (Predicted Label)"
author: "Chunyen"
date: "2024/3/13"
output: 
  pdf_document:
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
header-includes:
  - \usepackage{fontspec}
  - \setmainfont{Noto Sans CJK TC}
---

# Introduction

視覺化逐句累積輸入時模型預測的模型預測類別。

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r include=FALSE}
# import libraries
library(tidyverse)
library(ggplot2)
library(yardstick)
```

```{r}
# set working directory
setwd("/home/quantlab/2024_ChunyenThesis/Bert")
```

```{r include=FALSE}
# Fix the Mandarin font issue
library(showtext)

# 添加字體
# font_add("Noto Sans CJK TC", "/usr/share/fonts/opentype/noto/NotoSansCJK-Light.ttc")
font_add("Noto Sans CJK TC", "/notebooks/exploratory/NotoSansCJK-Light.ttc")

# 啟用 showtext_auto() 自動渲染文字
showtext_auto()

```

# Function

```{r}
# Function

# Read predict label data
Read_predict_label <- function(risklevel, refSentence, allFilesName_vec, foldpath){
  filteredFilesName <- allFilesName_vec[grep(risklevel, allFilesName_vec)]
  filteredFilesName <- filteredFilesName[grep(refSentence, filteredFilesName)]
  filteredFilesName <- filteredFilesName[grep("predict_label", filteredFilesName)]
  # It should be only one file
  input_tib <- read_csv(paste0(foldpath, "/", filteredFilesName))
  return(input_tib)
}
# Read predict metric data
Read_predict_metric <- function(risklevel, refSentence, allFilesName_vec, foldpath){
  filteredFilesName <- allFilesName_vec[grep(risklevel, allFilesName_vec)]
  filteredFilesName <- filteredFilesName[grep(refSentence, filteredFilesName)]
  filteredFilesName <- filteredFilesName[grep("predict_metric", filteredFilesName)]
  # It should be only one file
  input_tib <- read_csv(paste0(foldpath, "/", filteredFilesName))
  return(input_tib)
}

# Plot predict label
Plot_predict_label <- function(predict_label_tib, title, risklevel){
  level_num <- sub("risk", "", risklevel) %>% as.integer()
  title <- sprintf("%s (%s Risk Level)", title, level_num)
  ggplot(data = predict_label_tib, 
         aes(x = cum_ut, 
             y = y_pred, 
             group = dialogue_id, 
             color = factor(dialogue_id))) +
    geom_line() +
    labs(x = "Cumulative Utterances Number", y = "Predicted Label", title = title) +
    scale_color_discrete(name = "Risk Label") +
    theme_minimal() +
    theme(legend.position = "none") +
    scale_y_continuous(limits = c(0, level_num-1), breaks = seq(0, level_num-1, 1))+
    scale_x_continuous(limits = c(0, NA), breaks = seq(0, 1000, 200))
}
```



```{r}
# Set folder path
processed_path <- "data/processed/"
rfReports_path <- "results/rf_cum_utterance"
bertReports_path <- "results/bert_cum_utterance"

rf_allFilesName_vec <- list.files(rfReports_path, pattern = "\\.csv$", full.names = TRUE) %>% basename()
bert_allFilesName_vec <- list.files(bertReports_path, pattern = "\\.csv$", full.names = TRUE) %>% basename()

```

```{r include=FALSE}
# read transcript and risklevel data
risklevel_tib <- read_csv(paste0(processed_path, "risklevel.csv"))
transcript_caller_tib <- read_csv(paste0(processed_path, "transcripts_emb_caller.csv"))
transcript_responser_tib <- read_csv(paste0(processed_path, "transcripts_emb_responser.csv"))

# Count utterances by each dialogue_id
utNum_caller_tib <- transcript_caller_tib %>% 
  group_by(dialogue_id) %>%
  summarise(utNum_caller = n())
utNum_responser_tib <- transcript_responser_tib %>% 
  group_by(dialogue_id) %>%
  summarise(utNum_responser = n())

# join by dialogue_id
utNum_tib <- utNum_caller_tib %>% 
  left_join(., utNum_responser_tib, by = "dialogue_id")
data_tib <- risklevel_tib %>% 
  left_join(., utNum_tib, by = "dialogue_id")

# Group transcripts by utterance number of caller
cut_off1 <- 150
cut_off2 <- 300
data_tib <- data_tib %>% 
  mutate(utNum_caller_group = case_when(
    utNum_caller <= cut_off1 ~ "short",
    utNum_caller > cut_off1 & utNum_caller <= cut_off2 ~ "medium",
    utNum_caller > cut_off2 ~ "long"
  ))
# Group transcripts by utterance number of responser
cut_off1 <- 175
cut_off2 <- 350
data_tib <- data_tib %>% 
  mutate(utNum_responser_group = case_when(
    utNum_responser <= cut_off1 ~ "short",
    utNum_responser > cut_off1 & utNum_responser <= cut_off2 ~ "medium",
    utNum_responser > cut_off2 ~ "long"
  ))

groupDialogue_tib <- data_tib %>% 
  select(dialogue_id, utNum_caller_group, utNum_responser_group)
```

# Risk5 X RF Model

```{r include=FALSE}
risklevel <- "risk5"
refSentence <- "max_sim_ref3"
# read cumulative utterance predicted label data
rf_label_tib <- Read_predict_label(risklevel, refSentence, rf_allFilesName_vec, rfReports_path)
```

```{r}
rf_label_tib %>% 
  Plot_predict_label("RF Model Predicted Label Over Cumulative Utterances", risklevel)
```



# Risk5 X BERT Model

```{r include=FALSE}
# read cumulative utterance prediction data
risklevel <- "risk5"
refSentence <- "max_sim_ref2"
# read cumulative utterance predicted label data
bert_label_tib <- Read_predict_label(risklevel, refSentence, bert_allFilesName_vec, bertReports_path)
```

```{r}
bert_label_tib %>% 
  Plot_predict_label("BERT Model Predicted Label Over Cumulative Utterances", risklevel)

```

## groupby utterance number

```{r}
g1 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "short") %>%
  Plot_predict_label("短語句組", risklevel)
g2 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "medium") %>%
  Plot_predict_label("中語句組", risklevel)
g3 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "long") %>%
  Plot_predict_label("長語句組", risklevel)

gridExtra::grid.arrange(g1, g2, g3, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )
```

## groupby risk level
```{r}
g4 <- bert_label_tib %>% 
  filter(risk5 == 4) %>%
  Plot_predict_label("Risk = 4", risklevel)
g5 <- bert_label_tib %>%
  filter(risk5 == 3) %>%
  Plot_predict_label("Risk = 3", risklevel)
g6 <- bert_label_tib %>%
  filter(risk5 == 2) %>%
  Plot_predict_label("Risk = 2", risklevel)
g7 <- bert_label_tib %>%
  filter(risk5 == 1) %>%
  Plot_predict_label("Risk = 1", risklevel)
g8 <- bert_label_tib %>%
  filter(risk5 == 0) %>%
  Plot_predict_label("Risk = 0", risklevel)

gridExtra::grid.arrange(g4, g5, g6, g7, g8, ncol = 1, nrow = 5,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )
```

## group by risk level and utterance number
```{r}
g9 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 4 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 4, 短語句組", risklevel)
g10 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 4 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 4, 中語句組", risklevel)
g11 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 4 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 4, 長語句組", risklevel)

gridExtra::grid.arrange(g9, g10, g11, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )

g12 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 3 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 3, 短語句組", risklevel)
g13 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 3 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 3, 中語句組", risklevel)
g14 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 3 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 3, 長語句組", risklevel)

gridExtra::grid.arrange(g12, g13, g14, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )

g15 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 2 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 2, 短語句組", risklevel)
g16 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 2 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 2, 中語句組", risklevel)
g17 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 2 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 2, 長語句組", risklevel)

gridExtra::grid.arrange(g15, g16, g17, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )

g18 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 1 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 1, 短語句組", risklevel)
g19 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 1 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 1, 中語句組", risklevel)
g20 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 1 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 1, 長語句組", risklevel)

gridExtra::grid.arrange(g18, g19, g20, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )

g21 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 0 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 0, 短語句組", risklevel)
g22 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 0 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 0, 中語句組", risklevel)
g23 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk5 == 0 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 0, 長語句組", risklevel)

gridExtra::grid.arrange(g21, g22, g23, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk5)"
                        )
```



# Risk4 X RF Model

```{r include=FALSE}
risklevel <- "risk4"
refSentence <- "avg_sim_ref3"
# read cumulative utterance predicted label data
rf_label_tib <- Read_predict_label(risklevel, refSentence, rf_allFilesName_vec, rfReports_path)
```

```{r}
rf_label_tib %>% 
  Plot_predict_label("RF Model Predicted Label Over Cumulative Utterances", risklevel)
```


# Risk4 X BERT Model


```{r include=FALSE}
risklevel <- "risk4"
refSentence <- "avg_sim_ref2"
# read cumulative utterance predicted label data
bert_label_tib <- Read_predict_label(risklevel, refSentence, bert_allFilesName_vec, bertReports_path)
```

```{r}
bert_label_tib %>% 
  Plot_predict_label("BERT Model Predicted Label Over Cumulative Utterances", risklevel)
```

## groupby utterance number

```{r}
g1 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "short") %>%
  Plot_predict_label("短語句組", risklevel)
g2 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "medium") %>%
  Plot_predict_label("中語句組", risklevel)
g3 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "long") %>%
  Plot_predict_label("長語句組", risklevel)

gridExtra::grid.arrange(g1, g2, g3, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk4)"
                        )
```

## groupby risk level
```{r}
g4 <- bert_label_tib %>% 
  filter(risk4 == 3) %>%
  Plot_predict_label("Risk = 3", risklevel)
g5 <- bert_label_tib %>%
  filter(risk4 == 2) %>%
  Plot_predict_label("Risk = 2", risklevel)
g6 <- bert_label_tib %>%
  filter(risk4 == 1) %>%
  Plot_predict_label("Risk = 1", risklevel)
g7 <- bert_label_tib %>%
  filter(risk4 == 0) %>%
  Plot_predict_label("Risk = 0", risklevel)

gridExtra::grid.arrange(g4, g5, g6, g7, ncol = 1, nrow = 4,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk4)"
                        )
```

## group by risk level and utterance number
```{r}
g8 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk4 == 3 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 3, 短語句組", risklevel)
g9 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk4 == 3 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 3, 中語句組", risklevel)
g10 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk4 == 3 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 3, 長語句組", risklevel)

gridExtra::grid.arrange(g8, g9, g10, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk4)"
                        )

g11 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk4 == 2 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 2, 短語句組", risklevel)
g12 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk4 == 2 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 2, 中語句組", risklevel)
g13 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk4 == 2 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 2, 長語句組", risklevel)

gridExtra::grid.arrange(g11, g12, g13, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk4)"
                        )
```


# Risk3 X RF Model

```{r include=FALSE}
risklevel <- "risk3"
refSentence <- "max_sim_ref3"
# read cumulative utterance predicted label data
rf_label_tib <- Read_predict_label(risklevel, refSentence, rf_allFilesName_vec, rfReports_path)
```

```{r}
rf_label_tib %>% 
  Plot_predict_label("RF Model Predicted Label Over Cumulative Utterances", risklevel)
```

## groupby utterance number

```{r}
g1 <- rf_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "short") %>%
  Plot_predict_label("短語句組", risklevel)
g2 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "medium") %>%
  Plot_predict_label("中語句組", risklevel)
g3 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "long") %>%
  Plot_predict_label("長語句組", risklevel)

gridExtra::grid.arrange(g1, g2, g3, ncol = 1, nrow = 3,
                        top = "RF Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )
```

## groupby risk level
```{r}
g4 <- rf_label_tib %>% 
  filter(risk3 == 2) %>%
  Plot_predict_label("Risk = 2", risklevel)
g5 <- rf_label_tib %>%
  filter(risk3 == 1) %>%
  Plot_predict_label("Risk = 1", risklevel)
g6 <- rf_label_tib %>%
  filter(risk3 == 0) %>%
  Plot_predict_label("Risk = 0", risklevel)

gridExtra::grid.arrange(g4, g5, g6, ncol = 1, nrow = 3,
                        top = "RF Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )
```

## group by risk level and utterance number
```{r}
g7 <- rf_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 2 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 2, 短語句組", risklevel)
g8 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 2 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 2, 中語句組", risklevel)
g9 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 2 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 2, 長語句組", risklevel)

gridExtra::grid.arrange(g7, g8, g9, ncol = 1, nrow = 3,
                        top = "RF Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )

g10 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 1 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 1, 短語句組", risklevel)
g11 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 1 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 1, 中語句組", risklevel)
g12 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 1 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 1, 長語句組", risklevel)

gridExtra::grid.arrange(g10, g11, g12, ncol = 1, nrow = 3,
                        top = "RF Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )

g13 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 0 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 0, 短語句組", risklevel)
g14 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 0 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 0, 中語句組", risklevel)
g15 <- rf_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 0 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 0, 長語句組", risklevel)

gridExtra::grid.arrange(g13, g14, g15, ncol = 1, nrow = 3,
                        top = "RF Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )

```

# Risk3 X BERT Model

```{r include=FALSE}
risklevel <- "risk3"
refSentence <- "max_sim_ref1"
# read cumulative utterance predicted label data
bert_label_tib <- Read_predict_label(risklevel, refSentence, bert_allFilesName_vec, bertReports_path)
```


```{r}
bert_label_tib %>% 
  Plot_predict_label("BERT Model Predicted Label Over Cumulative Utterances", risklevel)
```

## groupby utterance number

```{r}
g1 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "short") %>%
  Plot_predict_label("短語句組", risklevel)
g2 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "medium") %>%
  Plot_predict_label("中語句組", risklevel)
g3 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(utNum_caller_group == "long") %>%
  Plot_predict_label("長語句組", risklevel)

gridExtra::grid.arrange(g1, g2, g3, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )
```

## groupby risk level
```{r}
g4 <- bert_label_tib %>% 
  filter(risk3 == 2) %>%
  Plot_predict_label("Risk = 2", risklevel)
g5 <- bert_label_tib %>%
  filter(risk3 == 1) %>%
  Plot_predict_label("Risk = 1", risklevel)
g6 <- bert_label_tib %>%
  filter(risk3 == 0) %>%
  Plot_predict_label("Risk = 0", risklevel)

gridExtra::grid.arrange(g4, g5, g6, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )
```

## group by risk level and utterance number
```{r}
g7 <- bert_label_tib %>% 
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 2 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 2, 短語句組", risklevel)
g8 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 2 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 2, 中語句組", risklevel)
g9 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 2 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 2, 長語句組", risklevel)

gridExtra::grid.arrange(g7, g8, g9, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )

g10 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 1 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 1, 短語句組", risklevel)
g11 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 1 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 1, 中語句組", risklevel)
g12 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 1 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 1, 長語句組", risklevel)
  
gridExtra::grid.arrange(g10, g11, g12, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )

g13 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 0 & utNum_caller_group == "short") %>%
  Plot_predict_label("Risk = 0, 短語句組", risklevel)
g14 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 0 & utNum_caller_group == "medium") %>%
  Plot_predict_label("Risk = 0, 中語句組", risklevel)
g15 <- bert_label_tib %>%
  left_join(., groupDialogue_tib, by = "dialogue_id") %>%
  filter(risk3 == 0 & utNum_caller_group == "long") %>%
  Plot_predict_label("Risk = 0, 長語句組", risklevel)

gridExtra::grid.arrange(g13, g14, g15, ncol = 1, nrow = 3,
                        top = "BERT Model Predicted Label Over Cumulative Utterances (Risk3)"
                        )
```
